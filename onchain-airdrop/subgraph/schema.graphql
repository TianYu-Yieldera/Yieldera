# Yieldera Airdrop Subgraph Schema

"""
空投活动实体
"""
type AirdropCampaign @entity {
  id: ID!                           # campaignId
  name: String!                     # 活动名称
  description: String!              # 活动描述
  merkleRoot: Bytes!                # Merkle树根
  totalBudget: BigInt!              # 总预算
  claimedAmount: BigInt!            # 已领取金额
  remainingBudget: BigInt!          # 剩余预算
  startTime: BigInt!                # 开始时间（Unix timestamp）
  endTime: BigInt!                  # 结束时间（Unix timestamp）
  isActive: Boolean!                # 是否激活
  participantCount: Int!            # 参与人数
  claimCount: Int!                  # 总领取次数
  creator: Bytes!                   # 创建者地址
  createdAt: BigInt!                # 创建时间
  updatedAt: BigInt!                # 更新时间

  # 关联
  claims: [Claim!]! @derivedFrom(field: "campaign")
  dailySnapshots: [DailySnapshot!]! @derivedFrom(field: "campaign")
}

"""
用户实体
"""
type User @entity {
  id: ID!                           # 用户地址（小写）
  totalClaimed: BigInt!             # 累计领取总额
  claimCount: Int!                  # 领取次数
  campaignCount: Int!               # 参与活动数
  firstClaimAt: BigInt              # 首次领取时间
  lastClaimAt: BigInt               # 最后领取时间

  # 关联
  claims: [Claim!]! @derivedFrom(field: "user")
}

"""
领取记录实体
"""
type Claim @entity {
  id: ID!                           # txHash-logIndex
  campaign: AirdropCampaign!        # 关联活动
  user: User!                       # 关联用户
  amount: BigInt!                   # 领取金额
  timestamp: BigInt!                # 领取时间
  blockNumber: BigInt!              # 区块号
  transactionHash: Bytes!           # 交易哈希
}

"""
每日快照（用于趋势分析）
"""
type DailySnapshot @entity {
  id: ID!                           # campaignId-YYYY-MM-DD
  campaign: AirdropCampaign!        # 关联活动
  date: String!                     # 日期（YYYY-MM-DD）
  claimCount: Int!                  # 当日领取次数
  totalAmount: BigInt!              # 当日领取总额
  uniqueClaimers: Int!              # 当日独立领取人数
  cumulativeClaimCount: Int!        # 累计领取次数
  cumulativeAmount: BigInt!         # 累计领取总额
}

"""
全局统计（整个协议）
"""
type GlobalStats @entity {
  id: ID!                           # "global"
  totalCampaigns: Int!              # 总活动数
  activeCampaigns: Int!             # 活跃活动数
  totalDistributed: BigInt!         # 总分发金额
  totalClaims: Int!                 # 总领取次数
  totalUsers: Int!                  # 总用户数
  updatedAt: BigInt!                # 更新时间
}

"""
活动状态变更日志
"""
type CampaignStatusUpdate @entity {
  id: ID!                           # txHash-logIndex
  campaign: AirdropCampaign!        # 关联活动
  isActive: Boolean!                # 新状态
  timestamp: BigInt!                # 变更时间
  blockNumber: BigInt!              # 区块号
  transactionHash: Bytes!           # 交易哈希
}
