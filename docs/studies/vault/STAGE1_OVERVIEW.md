# é˜¶æ®µ1ï¼šé¡¹ç›®æ¦‚è§ˆä¸Žæž¶æž„ï¼ˆ3ä¸ªä»»åŠ¡ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹å¯¹ Yieldera çš„æ•´ä½“è®¤çŸ¥ï¼Œæ˜Žç¡®é‡‘åº“æ¨¡å—åœ¨ç³»ç»Ÿä¸­çš„ä½ç½®

**é¢„è®¡æ—¶é—´**ï¼š2å¤©ï¼ˆ6-8å°æ—¶ï¼‰

---

## ä»»åŠ¡ 1.1 - æž¶æž„é¸Ÿçž°å›¾

### ðŸ“š æ™¨è¯»å†…å®¹ï¼ˆ30åˆ†é’Ÿï¼‰

#### éœ€è¦é˜…è¯»çš„æ–‡ä»¶ï¼š
1. `README.md` - é¡¹ç›®æ•´ä½“ä»‹ç»
2. `YIELDERA_BRAND_GUIDE.md` - å“ç‰Œå’ŒæŠ€æœ¯å®šä½
3. `contracts/core/` - æ ¸å¿ƒåˆçº¦ç›®å½•ç»“æž„
4. `internal/blockchain/` - Go åŽç«¯åŒºå—é“¾äº¤äº’å±‚

#### å…³é”®ç†è§£ç‚¹ï¼š
- **Yieldera çš„å®šä½**ï¼šç§¯åˆ†èšåˆ + DeFi æ”¶ç›Šä¼˜åŒ–å¹³å°
- **é‡‘åº“çš„è§’è‰²**ï¼šèµ„äº§æ‰˜ç®¡ + æ”¶ç›Šç­–ç•¥æ‰§è¡Œ
- **æŠ€æœ¯æ ˆ**ï¼šSolidity + Go + React + PostgreSQL
- **å¤–éƒ¨ä¾èµ–**ï¼šAaveã€Uniswapã€Chainlink

### ðŸ’» æ™šç»ƒä»»åŠ¡ï¼ˆ60åˆ†é’Ÿï¼‰

#### 1. ç»˜åˆ¶ 4 å±‚æž¶æž„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚                                 â”‚
â”‚  Web3 Wallet + å‰ç«¯ç•Œé¢ (React)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ™ºèƒ½åˆçº¦å±‚                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚CollateralVaultâ”‚  â”‚ LoyaltyUSD  â”‚  â”‚DeFi Adaptersâ”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŽç«¯æœåŠ¡å±‚ (Go)                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚  åŒºå—é“¾ç›‘å¬  â”‚  â”‚  APIæœåŠ¡     â”‚  â”‚  æ•°æ®å¤„ç†    â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨åè®®å±‚                               â”‚
â”‚  Aave  â”‚  Uniswap V3  â”‚  Chainlink  â”‚  è·¨é“¾æ¡¥               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. æ ‡æ³¨å…³é”®ç»„ä»¶

åˆ›å»ºç»„ä»¶æ¸…å•è¡¨ï¼š

| å±‚çº§ | ç»„ä»¶åç§° | ä¸»è¦èŒè´£ | è¾“å…¥ | è¾“å‡º |
|------|---------|---------|------|------|
| åˆçº¦å±‚ | CollateralVault | èµ„é‡‘æ‰˜ç®¡ã€ä»½é¢ç®¡ç† | ETH/Token | Shares |
| åˆçº¦å±‚ | LoyaltyUSD | ç¨³å®šå¸é“¸é€  | æŠµæŠ¼å“ | LUSD |
| åˆçº¦å±‚ | PriceOracle | ä»·æ ¼åé¦ˆ | Tokenåœ°å€ | USDä»·æ ¼ |
| åŽç«¯å±‚ | VaultService | äº‹ä»¶ç›‘å¬ã€çŠ¶æ€åŒæ­¥ | é“¾ä¸Šäº‹ä»¶ | DBè®°å½• |
| åŽç«¯å±‚ | MetricsService | æŒ‡æ ‡è®¡ç®— | åŽŸå§‹æ•°æ® | APY/TVL |
| å‰ç«¯å±‚ | VaultView | ç”¨æˆ·äº¤äº’ | ç”¨æˆ·æ“ä½œ | äº¤æ˜“ç­¾å |

#### 3. æ’°å†™æž¶æž„æ–‡æ¡£

åˆ›å»º `01_arch_overview.md`ï¼ŒåŒ…å«ï¼š

```markdown
# Yieldera æž¶æž„æ¦‚è§ˆ

## ç³»ç»Ÿå®šä½
[1-2æ®µæè¿°é¡¹ç›®æ„¿æ™¯å’ŒæŠ€æœ¯ç‰¹ç‚¹]

## å››å±‚æž¶æž„

### 1. ç”¨æˆ·å±‚
- åŠŸèƒ½ï¼š...
- æŠ€æœ¯æ ˆï¼š...
- å…³é”®äº¤äº’ï¼š...

### 2. æ™ºèƒ½åˆçº¦å±‚
[è¯¦ç»†æè¿°æ¯ä¸ªåˆçº¦çš„èŒè´£]

### 3. åŽç«¯æœåŠ¡å±‚
[æè¿° Go æœåŠ¡çš„æž¶æž„]

### 4. å¤–éƒ¨åè®®å±‚
[åˆ—å‡ºä¾èµ–çš„ DeFi åè®®]

## é‡‘åº“æ¨¡å—ä½ç½®
[ä¸“é—¨è¯´æ˜Žé‡‘åº“åœ¨æ•´ä¸ªç³»ç»Ÿä¸­çš„ä½ç½®å’Œä½œç”¨]

## å…³é”®è®¾è®¡å†³ç­–
1. ä¸ºä»€ä¹ˆé€‰æ‹© EIP-4626 æ ‡å‡†ï¼Ÿ
2. ä¸ºä»€ä¹ˆéœ€è¦ Go åŽç«¯ï¼Ÿ
3. å¦‚ä½•å¤„ç†è·¨é“¾ï¼Ÿ

## æž¶æž„å›¾
[ç²˜è´´æˆ–é“¾æŽ¥å›¾ç‰‡]
```

### âœ… é€šè¿‡æ ‡å‡†

**è‡ªæˆ‘æµ‹è¯•**ï¼šé—­ä¸Šçœ¼ç›ï¼Œ2-3åˆ†é’Ÿå†…å£è¿°ï¼š
1. ç”¨æˆ·å­˜æ¬¾çš„å®Œæ•´è·¯å¾„ï¼ˆä»Žé’±åŒ…åˆ°ç­–ç•¥ï¼‰
2. é‡‘åº“å¦‚ä½•ä¸Ž DeFi åè®®äº¤äº’
3. åŽç«¯çš„ 3 ä¸ªä¸»è¦èŒè´£
4. å“ªäº›æ•°æ®åœ¨é“¾ä¸Šï¼Œå“ªäº›åœ¨é“¾ä¸‹

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æž¶æž„å›¾æ¸…æ™°æ ‡æ³¨äº† 4 å±‚
- [ ] æ¯å±‚è‡³å°‘ 3 ä¸ªç»„ä»¶
- [ ] æ•°æ®æµå‘æ ‡æ³¨æ¸…æ¥š
- [ ] æ–‡æ¡£ä¸å°‘äºŽ 500 å­—
- [ ] åŒ…å«è‡³å°‘ 1 ä¸ªè®¾è®¡æƒè¡¡è¯´æ˜Ž

---

## ä»»åŠ¡ 1.2 - å…³é”®è¾¹ç•Œä¸Žæ•°æ®æµ

### ðŸ“š æ™¨è¯»å†…å®¹ï¼ˆ45åˆ†é’Ÿï¼‰

#### æ ¸å¿ƒé—®é¢˜ï¼š
1. ç”¨æˆ·å¦‚ä½•å­˜å…¥èµ„é‡‘ï¼Ÿ
2. é‡‘åº“å¦‚ä½•çŸ¥é“æ”¶ç›Šï¼Ÿ
3. ç”¨æˆ·å¦‚ä½•èµŽå›žï¼Ÿ
4. é£Žé™©äº‹ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ
5. è·¨é“¾æ¶ˆæ¯å¦‚ä½•ä¼ é€’ï¼Ÿ
6. å‰åŽç«¯å¦‚ä½•åŒæ­¥çŠ¶æ€ï¼Ÿ

#### éœ€è¦æ¢³ç†çš„äº¤äº’ï¼š
```
äº¤äº’1: ç”¨æˆ·å­˜æ¬¾
ç”¨æˆ· â†’ é’±åŒ…æŽˆæƒ â†’ åˆçº¦å­˜æ¬¾ â†’ äº‹ä»¶å‘å‡º â†’ åŽç«¯æ•èŽ· â†’ DBè®°å½• â†’ å‰ç«¯åˆ·æ–°

äº¤äº’2: ç­–ç•¥æ”¶ç›Š
å®šæ—¶å™¨ â†’ è°ƒç”¨harvest â†’ æ”¶ç›Šæ¢å›ž â†’ PPSä¸Šæ¶¨ â†’ äº‹ä»¶é€šçŸ¥ â†’ æŒ‡æ ‡æ›´æ–°

äº¤äº’3: ç”¨æˆ·èµŽå›ž
ç”¨æˆ·è¯·æ±‚ â†’ åˆçº¦è®¡ç®— â†’ èµ„é‡‘è½¬å‡º â†’ äº‹ä»¶è®°å½• â†’ åŽç«¯æ›´æ–° â†’ ä½™é¢åˆ·æ–°

äº¤äº’4: ä»·æ ¼æ›´æ–°
é¢„è¨€æœº â†’ é“¾ä¸Šå–‚ä»· â†’ åˆçº¦è¯»å– â†’ å¥åº·åº¦æ£€æŸ¥ â†’ é£ŽæŽ§å†³ç­–

äº¤äº’5: æ¸…ç®—æµç¨‹
ç›‘æŽ§æ£€æµ‹ â†’ æ¸…ç®—è§¦å‘ â†’ æŠµæŠ¼å“æ‹å– â†’ å€ºåŠ¡æ¸…å¿ â†’ çŠ¶æ€åŒæ­¥

äº¤äº’6: è·¨é“¾æ¡¥æŽ¥
æºé“¾äº‹ä»¶ â†’ ä¸­ç»§æ•èŽ· â†’ ç›®æ ‡é“¾éªŒè¯ â†’ çŠ¶æ€åŒæ­¥ â†’ ç¡®è®¤å›žæ‰§
```

### ðŸ’» æ™šç»ƒä»»åŠ¡ï¼ˆ75åˆ†é’Ÿï¼‰

#### 1. ç»˜åˆ¶æ—¶åºå›¾

ä¸ºæ¯ä¸ªå…³é”®æµç¨‹ç”»æ—¶åºå›¾ï¼Œä½¿ç”¨ Mermaid è¯­æ³•ï¼š

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Wallet as é’±åŒ…
    participant Vault as é‡‘åº“åˆçº¦
    participant Backend as åŽç«¯æœåŠ¡
    participant DB as æ•°æ®åº“
    participant Frontend as å‰ç«¯

    User->>Wallet: å‘èµ·å­˜æ¬¾
    Wallet->>Vault: approve(token, amount)
    Vault-->>Wallet: ç¡®è®¤æŽˆæƒ
    Wallet->>Vault: deposit(amount)

    Vault->>Vault: è®¡ç®— shares
    Vault->>Vault: mint shares
    Vault->>Backend: emit Depositäº‹ä»¶

    Backend->>DB: è®°å½•å­˜æ¬¾
    Backend->>Frontend: WebSocketé€šçŸ¥
    Frontend->>User: æ˜¾ç¤ºæ–°ä½™é¢

    Note over Vault,Backend: å¼‚æ­¥æ‰§è¡Œç­–ç•¥éƒ¨ç½²
```

#### 2. åˆ›å»ºæ•…éšœåœºæ™¯è¡¨

| åœºæ™¯ | è§¦å‘æ¡ä»¶ | æ£€æµ‹æ–¹å¼ | å›žæ»šæœºåˆ¶ | ç”¨æˆ·æç¤º |
|------|---------|---------|---------|---------|
| Gasä¸è¶³ | äº¤æ˜“å‘é€å¤±è´¥ | å‰ç«¯é¢„ä¼° | ä¸å‘é€äº¤æ˜“ | "è¯·å¢žåŠ Gasé™é¢" |
| æµåŠ¨æ€§ä¸è¶³ | èµŽå›žé‡‘é¢è¿‡å¤§ | åˆçº¦æ£€æŸ¥ | revert | "è¶…è¿‡å¯ç”¨æµåŠ¨æ€§" |
| é¢„è¨€æœºå¤±æ•ˆ | ä»·æ ¼é™ˆæ—§ | æ—¶é—´æˆ³æ£€æŸ¥ | æš‚åœæ“ä½œ | "ç³»ç»Ÿç»´æŠ¤ä¸­" |
| åŽç«¯å®•æœº | äº‹ä»¶æœªæ•èŽ· | ç›‘æŽ§å‘Šè­¦ | é‡æ”¾æ—¥å¿— | æ­£å¸¸ï¼ˆé“¾ä¸Šæ•°æ®ä¸ºå‡†ï¼‰|

#### 3. æ’°å†™æ•°æ®æµæ–‡æ¡£

åˆ›å»º `02_dataflows.md`ï¼š

```markdown
# Yieldera å…³é”®æ•°æ®æµ

## æ•°æ®æµ1: ç”¨æˆ·å­˜æ¬¾
### å‚ä¸Žæ–¹
- ç”¨æˆ·ã€é’±åŒ…ã€é‡‘åº“åˆçº¦ã€åŽç«¯ã€æ•°æ®åº“ã€å‰ç«¯

### è¾“å…¥
- amount: uint256 (å­˜æ¬¾é‡‘é¢)
- token: address (ä»£å¸åœ°å€)

### æµç¨‹
1. [å‰ç«¯] ç”¨æˆ·è¾“å…¥é‡‘é¢
2. [é’±åŒ…] ç­¾åæŽˆæƒäº¤æ˜“
3. [åˆçº¦] éªŒè¯ä½™é¢å’ŒæŽˆæƒ
4. [åˆçº¦] è®¡ç®—å¹¶é“¸é€ ä»½é¢
5. [åˆçº¦] å‘å‡º Deposit äº‹ä»¶
6. [åŽç«¯] ç›‘å¬åˆ°äº‹ä»¶
7. [åŽç«¯] è§£æžå‚æ•°å¹¶å†™å…¥DB
8. [å‰ç«¯] è½®è¯¢æˆ–è®¢é˜…æ›´æ–°

### è¾“å‡º
- shares: uint256 (ç”¨æˆ·èŽ·å¾—çš„ä»½é¢)
- äº‹ä»¶: Deposit(user, amount, shares)
- DBè®°å½•: deposits è¡¨æ–°å¢žä¸€è¡Œ

### å¤±è´¥åœºæ™¯
| å¤±è´¥ç‚¹ | åŽŸå›  | å›žæ»š |
|--------|------|------|
| Step2 | ç”¨æˆ·å–æ¶ˆ | æ— çŠ¶æ€å˜åŒ– |
| Step3 | ä½™é¢ä¸è¶³ | revert |
| Step4 | è®¡ç®—æº¢å‡º | revert |
| Step6 | ç½‘ç»œå»¶è¿Ÿ | åŽç»­è¡¥å¿ |

### å…³é”®ä¸å˜é‡
- totalAssets = sum(userBalances)
- totalShares = sum(userShares)
- PPS = totalAssets / totalShares

---

[ç»§ç»­æè¿°å…¶ä»– 5 ä¸ªæ•°æ®æµ...]
```

### âœ… é€šè¿‡æ ‡å‡†

**éªŒæ”¶è¦ç‚¹**ï¼š
- [ ] è‡³å°‘ 6 æ¡æ•°æ®æµ
- [ ] æ¯æ¡åŒ…å«ï¼šè§¦å‘æ–¹ã€è¾“å…¥ã€è¾“å‡ºã€å¤±è´¥åœºæ™¯
- [ ] è‡³å°‘ 3 ä¸ªæ—¶åºå›¾
- [ ] æ ‡æ³¨äº†å…³é”®ä¸å˜é‡
- [ ] è¯´æ˜Žäº†å›žæ»šæœºåˆ¶

**è‡ªæµ‹é—®é¢˜**ï¼š
1. å¦‚æžœåŽç«¯å®•æœºï¼Œç”¨æˆ·èµ„é‡‘å®‰å…¨å—ï¼Ÿ
2. äº‹ä»¶é‡æ”¾å¦‚ä½•é¿å…åŒèŠ±ï¼Ÿ
3. PPS æ›´æ–°çš„è§¦å‘æ—¶æœºï¼Ÿ

---

## ä»»åŠ¡ 1.3 - æœ¯è¯­è¡¨

### ðŸ“š æ™¨è¯»å†…å®¹ï¼ˆ30åˆ†é’Ÿï¼‰

#### éœ€è¦æŽŒæ¡çš„æœ¯è¯­åˆ†ç±»ï¼š

**é‡‘åº“ç›¸å…³**
- PPS (Price Per Share)
- TVL (Total Value Locked)
- Share (ä»½é¢)
- Harvest (æ”¶èŽ·)
- Rebalance (å†å¹³è¡¡)
- Strategy (ç­–ç•¥)
- Buffer (ç¼“å†²æ± )

**DeFi é€šç”¨**
- APY/APR
- Slippage (æ»‘ç‚¹)
- Liquidity (æµåŠ¨æ€§)
- LP Token
- Yield Farming
- Impermanent Loss

**å€Ÿè´·ç›¸å…³**
- LTV (Loan-to-Value)
- HF (Health Factor)
- Collateral Ratio
- Liquidation
- Interest Rate

**æŠ€æœ¯ç›¸å…³**
- TWAB (Time-Weighted Average Balance)
- Oracle (é¢„è¨€æœº)
- Keeper/Bot
- Gas Optimization
- Reentrancy

### ðŸ’» æ™šç»ƒä»»åŠ¡ï¼ˆ45åˆ†é’Ÿï¼‰

åˆ›å»º `03_glossary.md`ï¼š

```markdown
# Yieldera æœ¯è¯­è¡¨

## é‡‘åº“æ ¸å¿ƒæ¦‚å¿µ

### PPS (Price Per Share) - æ¯ä»½é¢ä»·æ ¼
**å®šä¹‰**ï¼š1 ä¸ªé‡‘åº“ä»½é¢å¯¹åº”çš„åŸºç¡€èµ„äº§ä»·å€¼

**å…¬å¼**ï¼š
```
PPS = totalAssets / totalShares
```

**ç¤ºä¾‹**ï¼š
- åˆå§‹ï¼šå­˜å…¥ 1000 USDCï¼Œé“¸é€  1000 ä»½é¢ï¼ŒPPS = 1.0
- æ”¶ç›ŠåŽï¼šèµ„äº§å˜ä¸º 1100 USDCï¼Œä»½é¢ä¸å˜ï¼ŒPPS = 1.1
- ç”¨æˆ·èµŽå›žï¼šæŒæœ‰ 100 ä»½é¢ï¼Œå¯èµŽå›ž 100 Ã— 1.1 = 110 USDC

**å…³é”®ç‰¹æ€§**ï¼š
- åªå¢žä¸å‡ï¼ˆé™¤éžäºæŸï¼‰
- å¤åˆ©æ•ˆåº”ä½“çŽ°åœ¨ PPS å¢žé•¿
- ä¸åŒç”¨æˆ·å…±äº«åŒä¸€ PPS

**ä»£ç ä½ç½®**ï¼š
```solidity
// CollateralVault.sol
function pricePerShare() public view returns (uint256) {
    if (totalShares == 0) return 1e18;
    return (totalAssets * 1e18) / totalShares;
}
```

---

### TVL (Total Value Locked) - é”å®šæ€»ä»·å€¼
**å®šä¹‰**ï¼šåè®®ä¸­é”å®šçš„æ‰€æœ‰èµ„äº§çš„ç¾Žå…ƒä»·å€¼æ€»å’Œ

**è®¡ç®—**ï¼š
```
TVL = Î£(tokenBalance_i Ã— tokenPrice_i)
```

**ç¤ºä¾‹**ï¼š
- é‡‘åº“Aï¼š1000 ETH Ã— $2000 = $2,000,000
- é‡‘åº“Bï¼š500,000 USDC Ã— $1 = $500,000
- æ€»TVL = $2,500,000

**æ„ä¹‰**ï¼š
- è¡¡é‡åè®®è§„æ¨¡
- å½±å“æ”¶ç›Šåˆ†é…æ•ˆçŽ‡
- é£Žé™©æ‰¿å—èƒ½åŠ›æŒ‡æ ‡

---

### Share - é‡‘åº“ä»½é¢
**å®šä¹‰**ï¼šç”¨æˆ·åœ¨é‡‘åº“ä¸­æ‰€æœ‰æƒçš„è¯æ˜Žï¼Œç±»ä¼¼è‚¡ç¥¨

**å·¥ä½œæœºåˆ¶**ï¼š
```
å­˜æ¬¾æ—¶ï¼šshares = amount / PPS
èµŽå›žæ—¶ï¼šamount = shares Ã— PPS
```

**ç¤ºä¾‹**ï¼š
- Alice å­˜å…¥ 100 USDCï¼ˆPPS=1.0ï¼‰â†’ èŽ·å¾— 100 ä»½é¢
- Bob å­˜å…¥ 100 USDCï¼ˆPPS=1.1ï¼‰â†’ èŽ·å¾— 90.9 ä»½é¢
- ä¸¤äººæŒæœ‰ä¸åŒä»½é¢ï¼Œä½†äº«å—ç›¸åŒçš„æ”¶ç›ŠçŽ‡

---

### Harvest - æ”¶èŽ·æ”¶ç›Š
**å®šä¹‰**ï¼šå°†ç­–ç•¥ä¸­èµšå–çš„å¥–åŠ±ä»£å¸æ¢å›žåŸºç¡€èµ„äº§ï¼Œæé«˜ PPS

**æµç¨‹**ï¼š
1. ä»Ž Aave/Uni ç­‰åè®®é¢†å–å¥–åŠ±ä»£å¸
2. é€šè¿‡ DEX æ¢å›ž USDC
3. æ‰£é™¤ç®¡ç†è´¹
4. é‡æ–°æŠ•å…¥ç­–ç•¥
5. PPS ä¸Šæ¶¨

**è§¦å‘æ¡ä»¶**ï¼š
- æ”¶ç›Š > Gas æˆæœ¬ + æ»‘ç‚¹
- è·ä¸Šæ¬¡ harvest è¶…è¿‡ X å°æ—¶
- æ‰‹åŠ¨è§¦å‘ï¼ˆç®¡ç†å‘˜ï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š
```solidity
function harvest() external onlyKeeper {
    uint256 rewards = strategy.claimRewards();
    uint256 assets = swap(rewards, baseToken);
    totalAssets += assets;
    emit Harvested(assets);
}
```

---

## DeFi é€šç”¨æœ¯è¯­

### APY (Annual Percentage Yield) - å¹´åŒ–æ”¶ç›ŠçŽ‡
**å®šä¹‰**ï¼šè€ƒè™‘å¤åˆ©çš„å¹´åŒ–æ”¶ç›Šç™¾åˆ†æ¯”

**å…¬å¼**ï¼š
```
APY = (1 + r/n)^n - 1
r = æœŸé—´æ”¶ç›ŠçŽ‡
n = å¤åˆ©æ¬¡æ•°
```

**ç¤ºä¾‹**ï¼š
- æ—¥æ”¶ç›Š 0.1%ï¼Œå¹´åŒ– APY = (1.001)^365 - 1 = 44.02%
- æœˆæ”¶ç›Š 2%ï¼Œå¹´åŒ– APY = (1.02)^12 - 1 = 26.82%

**vs APR**ï¼šAPR ä¸è€ƒè™‘å¤åˆ©ï¼ŒAPY > APR

---

### Slippage - æ»‘ç‚¹
**å®šä¹‰**ï¼šäº¤æ˜“æ‰§è¡Œä»·æ ¼ä¸Žé¢„æœŸä»·æ ¼çš„åå·®

**å…¬å¼**ï¼š
```
Slippage = (æ‰§è¡Œä»·æ ¼ - é¢„æœŸä»·æ ¼) / é¢„æœŸä»·æ ¼ Ã— 100%
```

**ç¤ºä¾‹**ï¼š
- é¢„æœŸï¼š1 ETH = 2000 USDC
- å®žé™…ï¼š1 ETH = 1980 USDC
- æ»‘ç‚¹ = -1%

**é£Žé™©**ï¼š
- å¤§é¢äº¤æ˜“æ»‘ç‚¹æ›´å¤§
- ä½ŽæµåŠ¨æ€§æ± æ»‘ç‚¹é«˜
- å¯èƒ½è¢« MEV æ”»å‡»

---

## å€Ÿè´·æœ¯è¯­

### LTV (Loan-to-Value) - è´·æ¬¾ä»·å€¼æ¯”
**å®šä¹‰**ï¼šè´·æ¬¾é‡‘é¢å æŠµæŠ¼å“ä»·å€¼çš„ç™¾åˆ†æ¯”

**å…¬å¼**ï¼š
```
LTV = Debt / CollateralValue Ã— 100%
```

**ç¤ºä¾‹**ï¼š
- æŠµæŠ¼ 1 ETH ($2000)
- å€Ÿå‡º 1000 USDC
- LTV = 50%

**é™åˆ¶**ï¼š
- Max LTV = 75%ï¼ˆè¶…è¿‡åˆ™æ— æ³•å€Ÿæ¬¾ï¼‰
- Liquidation LTV = 80%ï¼ˆè¶…è¿‡åˆ™è¢«æ¸…ç®—ï¼‰

---

### Health Factor (HF) - å¥åº·å› å­
**å®šä¹‰**ï¼šè¡¡é‡å€Ÿè´·ä»“ä½å®‰å…¨æ€§çš„æŒ‡æ ‡

**å…¬å¼**ï¼š
```
HF = (Collateral Ã— LiquidationThreshold) / Debt
```

**é˜ˆå€¼**ï¼š
- HF > 1.0ï¼šå®‰å…¨
- HF = 1.0ï¼šä¸´ç•Œç‚¹
- HF < 1.0ï¼šå¯è¢«æ¸…ç®—

**ç¤ºä¾‹**ï¼š
- æŠµæŠ¼å“ï¼š$2000
- æ¸…ç®—é˜ˆå€¼ï¼š80%
- å€ºåŠ¡ï¼š$1200
- HF = (2000 Ã— 0.8) / 1200 = 1.33ï¼ˆå®‰å…¨ï¼‰

---

## æŠ€æœ¯æœ¯è¯­

### Oracle - é¢„è¨€æœº
**å®šä¹‰**ï¼šä¸ºæ™ºèƒ½åˆçº¦æä¾›é“¾ä¸‹æ•°æ®çš„æœåŠ¡

**ç±»åž‹**ï¼š
1. **Chainlink**ï¼šåŽ»ä¸­å¿ƒåŒ–é¢„è¨€æœºç½‘ç»œ
2. **TWAP**ï¼šåŸºäºŽ DEX çš„æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼
3. **æ‰‹åŠ¨å–‚ä»·**ï¼šç®¡ç†å‘˜æ›´æ–°

**é˜²æ“çºµ**ï¼š
- å¤šæºèšåˆ
- æ—¶é—´å»¶è¿Ÿ
- å¼‚å¸¸æ£€æµ‹

---

### Reentrancy - é‡å…¥æ”»å‡»
**å®šä¹‰**ï¼šåˆ©ç”¨å¤–éƒ¨è°ƒç”¨æ—¶çŠ¶æ€æœªæ›´æ–°çš„æ¼æ´ž

**ç¤ºä¾‹**ï¼š
```solidity
// é”™è¯¯ç¤ºä¾‹
function withdraw() external {
    uint amount = balances[msg.sender];
    msg.sender.call{value: amount}(""); // å¤–éƒ¨è°ƒç”¨
    balances[msg.sender] = 0; // æ™šäºŽå¤–éƒ¨è°ƒç”¨
}

// æ­£ç¡®ç¤ºä¾‹
function withdraw() external {
    uint amount = balances[msg.sender];
    balances[msg.sender] = 0; // å…ˆæ›´æ–°çŠ¶æ€
    msg.sender.call{value: amount}("");
}
```

**é˜²æŠ¤**ï¼š
- ä½¿ç”¨ ReentrancyGuard
- éµå¾ª Checks-Effects-Interactions æ¨¡å¼

---

## å¿«é€Ÿå‚è€ƒè¡¨

| æœ¯è¯­ | ä¸­æ–‡ | å…¸åž‹å€¼/èŒƒå›´ | å•ä½ |
|------|------|------------|------|
| PPS | æ¯ä»½é¢ä»·æ ¼ | 1.0 â†’ âˆž | èµ„äº§/ä»½é¢ |
| TVL | é”å®šæ€»ä»·å€¼ | $1M - $1B | USD |
| APY | å¹´åŒ–æ”¶ç›Š | 5% - 50% | % |
| LTV | è´·æ¬¾ä»·å€¼æ¯” | 0% - 75% | % |
| HF | å¥åº·å› å­ | 1.0 - 10.0 | å€æ•° |
| Slippage | æ»‘ç‚¹ | 0.1% - 5% | % |

---

## å»¶ä¼¸é˜…è¯»

- [EIP-4626](https://eips.ethereum.org/EIPS/eip-4626) - é‡‘åº“æ ‡å‡†
- [Yearn Finance Docs](https://docs.yearn.finance/) - é‡‘åº“å®žè·µ
- [Aave Documentation](https://docs.aave.com/) - å€Ÿè´·åè®®
- [Uniswap V3 Book](https://uniswapv3book.com/) - AMM åŽŸç†
```

### âœ… é€šè¿‡æ ‡å‡†

**éªŒæ”¶æ¸…å•**ï¼š
- [ ] è‡³å°‘ 20 ä¸ªæœ¯è¯­
- [ ] æ¯ä¸ªæœ¯è¯­åŒ…å«ï¼šå®šä¹‰ã€å…¬å¼ã€ç¤ºä¾‹
- [ ] åˆ†ç±»æ¸…æ™°ï¼ˆé‡‘åº“/DeFi/å€Ÿè´·/æŠ€æœ¯ï¼‰
- [ ] æä¾›ä»£ç ä½ç½®æˆ–ç¤ºä¾‹
- [ ] æœ‰å¿«é€Ÿå‚è€ƒè¡¨

**è‡ªæµ‹**ï¼šä»»é€‰ 5 ä¸ªæœ¯è¯­ï¼Œ1 åˆ†é’Ÿå†…è§£é‡Šæ¸…æ¥šå¹¶ä¸¾ä¾‹

---

## é˜¶æ®µ1æ€»ç»“

å®Œæˆä¸Šè¿° 3 ä¸ªä»»åŠ¡åŽï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

âœ… **ç†è§£èƒ½åŠ›**
- ç”¨ 5 åˆ†é’Ÿè®²æ¸…æ¥š Yieldera æ˜¯ä»€ä¹ˆ
- ç”»å‡ºç³»ç»Ÿæž¶æž„å¹¶è§£é‡Šæ¯å±‚ä½œç”¨
- è¯´æ˜Žé‡‘åº“åœ¨æ•´ä¸ªç”Ÿæ€ä¸­çš„ä½ç½®

âœ… **æŠ€æœ¯èƒ½åŠ›**
- è¯†åˆ« 6 æ¡å…³é”®æ•°æ®æµ
- ç†è§£ä»½é¢åˆ¶ä¼šè®¡çš„åŽŸç†
- æŽŒæ¡ 20+ æ ¸å¿ƒæœ¯è¯­

âœ… **äº§å‡ºç‰©**
- `01_arch_overview.md` - æž¶æž„æ–‡æ¡£
- `02_dataflows.md` - æ•°æ®æµæ–‡æ¡£
- `03_glossary.md` - æœ¯è¯­è¡¨

---

## ä¸‹ä¸€æ­¥

è¿›å…¥ [é˜¶æ®µ2: æ™ºèƒ½åˆçº¦å±‚](./STAGE2_CONTRACTS.md)ï¼Œæ·±å…¥å­¦ä¹ é‡‘åº“åˆçº¦çš„å®žçŽ°ç»†èŠ‚ã€‚
